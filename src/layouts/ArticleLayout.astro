---
import BaseLayout from './BaseLayout.astro';
import { siteConfig } from '../config/site';

interface Props {
  title: string;
  description: string;
  readTime?: string;
  datePublished?: string;
  dateModified?: string;
}

const {
  title,
  description,
  readTime = '5 min',
  datePublished = '2024-01-01',
  dateModified
} = Astro.props;

// Extract minutes from readTime string (e.g., "5 min" -> 5)
const readTimeMinutes = parseInt(readTime.replace(/\D/g, '')) || 5;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

// Article Schema.org JSON-LD
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "url": canonicalURL.toString(),
  "datePublished": datePublished,
  "dateModified": dateModified || datePublished,
  "timeRequired": `PT${readTimeMinutes}M`,
  "author": {
    "@type": "Person",
    "@id": siteConfig.url + "/charlotte-lagona",
    "name": siteConfig.contact.name,
    "jobTitle": "Psychologue FSP",
    "url": siteConfig.url + "/a-propos"
  },
  "publisher": {
    "@type": "Organization",
    "name": siteConfig.name,
    "url": siteConfig.url,
    "logo": {
      "@type": "ImageObject",
      "url": siteConfig.url + "/images/logo/logo.svg"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalURL.toString()
  },
  "isPartOf": {
    "@type": "WebSite",
    "name": siteConfig.name,
    "url": siteConfig.url
  },
  "about": [
    { "@type": "Thing", "name": "Psychologie" },
    { "@type": "Thing", "name": "Santé mentale" },
    { "@type": "Thing", "name": "Bien-être" }
  ],
  "inLanguage": "fr-CH"
};

// BreadcrumbList Schema
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Accueil",
      "item": siteConfig.url
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Ressources",
      "item": siteConfig.url + "/ressources"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": title,
      "item": canonicalURL.toString()
    }
  ]
};
---

<BaseLayout title={title} description={description}>
  <!-- Schema.org Article -->
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />

  <!-- Schema.org BreadcrumbList -->
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <article class="article-page">
    <!-- Header -->
    <header class="py-16 lg:py-24">
      <div class="container">
        <div class="max-w-3xl mx-auto">
          <a href="/ressources" class="back-link">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 19l-7-7 7-7"/>
            </svg>
            Retour aux ressources
          </a>
          <h1 class="text-3xl lg:text-4xl mt-6 mb-4">{title}</h1>
          <p class="text-text-light text-lg leading-relaxed mb-4">{description}</p>
          <p class="text-sm text-text-muted">Temps de lecture : {readTime}</p>
        </div>
      </div>
    </header>

    <!-- Content -->
    <div class="pb-16 lg:pb-24">
      <div class="container">
        <div class="max-w-3xl mx-auto prose">
          <slot />
        </div>
      </div>
    </div>

    <!-- CTA -->
    <section class="py-16 lg:py-20 bg-bg-alt">
      <div class="container">
        <div class="max-w-2xl mx-auto text-center">
          <h2 class="text-2xl mb-4">Vous souhaitez en parler ?</h2>
          <p class="text-text-light mb-8">
            Je suis à votre écoute pour répondre à vos questions.
          </p>
          <a
            href="/contact"
            class="inline-block px-8 py-3 border border-secondary/40 rounded-full text-text hover:border-secondary hover:bg-secondary/5 transition-all duration-300"
          >
            Voir les disponibilités
          </a>
        </div>
      </div>
    </section>
  </article>
</BaseLayout>

<style is:global>
  .back-link {
    display: inline-flex;
    align-items: center;
    font-size: 0.875rem;
    color: var(--color-text-muted);
    transition: color 0.3s ease;
  }

  .back-link:hover {
    color: var(--color-secondary);
  }

  /* Prose styles for article content */
  .prose {
    color: var(--color-text);
    line-height: 1.8;
  }

  .prose h2 {
    font-family: var(--font-heading);
    font-size: 1.75rem;
    font-weight: 500;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    color: var(--color-text);
  }

  .prose h3 {
    font-family: var(--font-heading);
    font-size: 1.375rem;
    font-weight: 500;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    color: var(--color-text);
  }

  .prose p {
    margin-bottom: 1.5rem;
    color: var(--color-text-light);
  }

  .prose ul, .prose ol {
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
  }

  .prose li {
    margin-bottom: 0.5rem;
    color: var(--color-text-light);
  }

  .prose ul li {
    list-style-type: disc;
  }

  .prose ol li {
    list-style-type: decimal;
  }

  .prose strong {
    color: var(--color-text);
    font-weight: 600;
  }

  .prose blockquote {
    border-left: 3px solid var(--color-secondary);
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    color: var(--color-text-light);
  }

  .prose a {
    color: var(--color-secondary);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .prose a:hover {
    text-decoration: none;
  }
</style>
